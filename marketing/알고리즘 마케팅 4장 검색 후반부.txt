[마케팅 데이터 분석 발표 준비]

4.4 적합한 신호 믹싱하기

- 앞서 살펴본 방법은 단순 텍스트로 표현된 아이템의 검색 방법임.
- 상품 검색은 다른 검색 응용분야와 마찬가지로 단순 텍스트만으로 이뤄져 있지는 않음.
- 아이템의 복수의 성질을 갖는 (이름, description, 브랜드 등) 텍스트를 고객의 query와 매칭시켜야 함
- 판매 데이터, 사용자 레이팅 등의 동적인 피처를 가질 수도 있고, 적합성과 같은 중요 정보를 담고 있을 수도 있음.
- 짧은 텍스트(제품명), 긴 텍스트(제품 설명/리뷰), 개별 데이터 토큰(숫자로 표현된 브랜드명), 중첩/계층적 정보(유사 제품 및 카테고리 등)
- 이 모든 정보를 응용하여 적합성 점수를 생성하기 위해 신호를 믹싱해주어야 함.
- 나이브한 접근으로는 모든 특성값을 하나의 큰 텍스트로 결합한 뒤 이 안에서 검색하는 스코어링 기법을 사용하는 것임.	
그러나 이 방식은 한계가 있음. 신호가 희미매지고 섞이는 등의 문제임. 이를 보완하기 위한 다른 방법을 고안해야함.


4.4.1 복수의 필드 검색
- 각 필드에 대해 복수의 쿼리를 돌리고 최종 스코어에 대해 신호를 믹스함
- (그림 4.8)

- 다른 필드에 대한 IDF는 비교가 불가능함 (청바지 설명에서는 blue가 흔하지만, 브랜드에서는 BLUE가 흔하지 않을 수 있으므로)

- 필드별로 가중치를 조절함으로써 신호의 불균형을 해결함. 가령 브랜드에는 큰 가중치를 매기되 제품 설명에는 적은 가중치를 매기는 방법등이 가능함.

4.4.2 신호 엔지니어링과 평준화
- 멀티필드 검색은 상보적이고 동시에 해결돼야 하는 "신호 엔지니어링"과 "신호 평준화" 두가지의 측면을 가지고 있음.
	1) 신호 엔지니어링: 깨끗하고 집중된 신호를 만들고자 함
	2) 신호 평준화(equilization): 최종 결과를 위해 서로다른 신호를 믹스함
- 더 나은 스코어링은 이 둘 중 하나의 접근을 취함으로써 획득 가능.

- 여러 필드를 검색할 때 다음과 같은 필드와 검색의도와의 관계가 성립 가능
	1) 하나의 강한 신호: 브랜드의 경우. 필드 중 하나와 매칭하고 하나의 강한 신호를 생성하는 특성을 검색하는 경우
	2) 강한 평균적인 신호: 검정색 13인치 모니터. 신호가 평준화되어 있고 같은 검색의도의 다른 측면에 관련돼 있는 경우.
	3) 분열된 특징과 신호: 여러 필드가 분열된 정보를 가지고 있는 경우. 이는 더 나은 신호를 얻기 위해 합쳐질 수 있음.
	

	4.4.2.1 하나의 강한 신호
	- 브랜드명 "out of the blue"의 경우 브랜드 신호의 부정확한 처리에서 비롯됨.
	- 가중값으로 조정하는 방법도 있지만 브랜드 신호를 덜 모호하게 고치는 방법을 생각할 수 있음.
	- 브랜드명의 경우 tf-idf 스코어링을 바이그램 스코어링으로 바꿀 수 있음.
	- 이 경우, 브랜드명이 질의에서 정확히 나왔을 겨웅에만 우선순위를 가지게 됨.
	- 4.10 그림에서의 검색 결과 구조는 조금 더 복잡하게 구성할 수도 있음. 우선 순위를 두는 필드를 하나씩 거쳐 나가며 결과를 걸러내는 방식임.
	
	4.4.2.2 강한 평균 신호
	- 앞서 살펴본 믹싱 함수의 계수를 조정하면 평균적인 신호에 기반을 둔 아이템을 정렬하도록 할 수 있음
	- 이 때, 필드 자체보다는 아이템에 들어맞는 기준의 수에 따라 정렬됨.
	- 여기서 스테밍 한 버전과 하지 않은 버전의 점수를 합함으로써 더 나은 결과를 도모할 수 있음(fashionable -> fashion)
	
	4.4.2.3 분해된 특징과 신호
	- 분해된 특징/신호 문제는 표준 멀티필드 검색이 각 필드를 독립적으로 스코어링하기 때문에 발생함.
	- polo/polo , Lacoste/polo 이 두 상품의 경우 Query Lacoste polo에 더 적합한 것은 두번째 것임.
	- tf-idf를 계산해보면 그 반대가 나옴.
	- 이는 브랜드 필드에서 해당 텍스트의 tf-idf를 구하고, 제품 필드에서 tf-idf를 구하기 때문임. 
	- 개선 방법
		1) 여러 개의 비슷한 필드를 하나로 통합 -> 분해/불균형된 신호 문제 제거
		2) 가장 강한 신호 전략 -> 각 토큰을 각각의 필드에 대해 점수를 매긴 뒤 그 중 최댓값만을 취해 가져옴.
		

4.4.3 신호 믹싱 파이프라인 디자인
- 앞서 살펴봤던 적합성 기준과 비즈니스 목적에 부합하도록 파이프라인을 설계해야 함.
- 특정 비즈니스 상황을 사례로 구체적인 설계를 보여주고 있으니, 관심 있으면 확인해 보는 것을 추천

4.5 의미 분석
- 앞서서는 토큰을 기준으로 살펴 보았으나, 자연어는 대부분 앞뒤 컨텍스트의 영향을 받아 다양한 의존 관계가 있음.
	1) 다의성: 한 단어가 여러 뜻을 가지고 있음. wood - 목재, 숲
	2) 동의성: 특정 컨텍스트에서 같은 의미를 갖게 되는 경우. (sweet, candy)
	
- 다의성 문제의 경우 n-gram 등을 활용해 해결 가능, 동의성은 stemming 등으로 해결 가능 
	-> 그러나 한께 존재.

- 의미분석의 문제는 단어와 개념 사이의 적합한 개념과 맵핑을 찾는 문제로 귀결될 수 있음.


	4.5.1 동의어와 계층
	- 유의어 사전: 가장 기본적인 솔루션.
	 	1) 축약형: confection을 candy로 바꿔줌
			(tf-idf에 악영향)
		2) 확장: confection을 sweet confection으로 바꿔줌.
			(계산 측면 손실)
	
	
	4.5.2 단어 임베딩
	- 벡터 스페이스 모델에서는 문헌/질의가 용어의 선형 공간에서 벡터로 표현될 수 있음.
	- 용어의 수만큼의 차원을 갖는 표현은 좋은 표현이라고 볼 수 없음. (동의성/다의성 문제에 의해 용어들이 모호해지거나 필요가 없어질 수 있음)
	- 이를 문헌 스페이스에 대한 basis를 바꾸면 좀 더 나은 표현을 얻을 수 있음
	- 문서와 쿼리를 실제 숫자 벡터에 맵핑할 수 있고, 랭킹 점수는 이 두 벡터간의 내적으로 계산할 수 있음.
	- 단어 차원의 고차원 표현을 저차원 공간으로 맵핑함으로써 "끼워넣기" 때문에 임베딩이라고 함.
	
	- 검색 서비스 측면에서의 두가지 가능성
		1) 쿼리에 대한 문서의 점수는 내적으로 계산 가능
		2) 임베딩된 표현은 유의어 사전을 만들기 위해 분석될 수 있음
	
	- 중요 문제: 어떻게 새로운 벡터 표현을 구축하는가?
		1) 동의어 문제 극복을 위해 공통 단어가 없더라도 쿼리에 적합한 문서 검색 가능
		2) 명목상 쿼리에 포함되어 있더라도 의미적으로 적합치 않은 문서 제외 가능
	
	
	4.5.3 잠재 의미 분석 (Latent Semantic Analysis)
	- 어떤 용어가 한 문서 내에서 자주 동시에 등장하는지를 알아내기 위헤, bag-of-words representation 분석
	- 공동 발생 분석은 명시적으로 용어에 드러나지 않지만 의미적으로, 잠재적으로 등장함. 이러한 개념을 잠재개념이라고 함
	- 분석을 위해 tf 행렬을 구함. 각 단어와 문서에 대한 tf 행렬 X
	- 문서간의 유사성은 열 벡터간 내적을 통해, 용어 사이의 유사성은 행 벡터간 내적으로 계산 가능
	
	- k 차원의 워드 임베딩을 구함. 여기서는 SVD 를 사용함.
	
	4.5.4 확률적 토픽 모델링
	- 토픽이라는 잠재변수를 통해 문서/단어 사이의 의미적 관계를 발견하는 의미분석 기법의 일종임.
	- 기본 가정(중 하나): 문서는 일정 확률적 프로세스에 따라 단계적 용어의 조합으로 생성됨.
	- 이 프로세스는 "토픽"으로 해석되는 잠재 변수를 사용함으로써 문서 집합의 의미적 구조를 모델링함.
	- 각 문헌은 토픽의 혼합으로 표현되고, 각 토픽은 문헌 안의 단어 분포를 결정함. 
	
	4.5.5 확률적 잠재 의미 분석 (pLSA)
	- 확률적 토픽 모델링의 첫번째 예시
	- 
	
	4.5.6 잠재 디리클레 할당 (LDA)
	
	4.5.7 word2vec
	
4.6 상품을 위한 검색 기법
- 지금까지 일반적인 검색 기법과 그 응용을 다룸. 여기서는 상품 검색을 위한 전문화된 접근을 제시함.
- 전문화된 접근이 필요한 몇가지 이유
	1) 구조화된 개체: 일반적인 검색 기법은 하나 이상의 텍스트 필드를 갖고있는, 상대적으로 단순한 구조의 문서를 검색하기 위함.
		그러나 상품검색은 구조화된 형태의 상품(식기 셋트) 등을 포함함. 이 안에는 다양한 특성을 가지고 있는 다양한 개체가 포함됨
	2) 상품의 다양성: 상품이 다양하고 많은 상품이 특정 성질을 공유하고 있으므로 정확한 검색을 어렵게 함.
	3) 복합어와 다의어: 같은 rose라도 브랜드를 의미할수도 있고 상품을, 색상을 의미할수도 있음
	

	4.6.1 결합 구절 검색
	- AND, OR 등을 사용한 결합 구절로 검색을 정확하게 만듦
	- 더 정확한 결과 전달 가능, 그러나 아무것도 나오지 않을 경우도 많아짐
	
	4.6.2 통제된 정확도 감소
	- 아무것도 나오지 않을 경우 추가 동작으로 부분적 필드 매치를 허용하는 벡터 스페이스 모델을 실행 가능
	- 다음 순서로 진행
		1) 정확한 매치
		2) 정규화, 스테밍, 스펠링 수정
		3) 싱글링
		4) 부분 매치
	
	4.6.3 중첩 개체와 동적 그룹화
	- 
	
	

